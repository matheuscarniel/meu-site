<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Administrativo</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: #f5f7fa;
      color: #333;
    }

    header {
      background: #f44336;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 22px;
      font-weight: 900;
      letter-spacing: 1px;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    h1 {
      font-size: 28px;
      font-weight: 900;
      margin-bottom: 20px;
      color: #f44336;
      text-align: center;
    }

    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
    }

    .form-group input,
    .form-group select,
    #editor {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: border 0.2s;
      box-sizing: border-box;
      background: #fff;
    }

    .form-group input:focus,
    .form-group select:focus,
    #editor:focus-within {
      outline: none;
      border-color: #f44336;
    }

    #editor {
      height: 250px;
      overflow-y: auto;
      margin-bottom: 20px;
    }

    button {
      background: #f44336;
      color: #fff;
      font-weight: 700;
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 15px;
    }
    button:hover {
      background: #d7352c;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .logout {
      display: block;
      margin: 20px auto 0;
      background: #555;
    }
    .logout:hover {
      background: #333;
    }

    /* Campo Nota s√≥ aparece se for Cr√≠tica */
    #nota-filme-group {
      display: none;
    }

    /* Estilo da Nota */
    .nota-filme {
      font-weight: bold;
      color: #f44336;
      margin-top: 16px;
      display: block;
    }
  </style>
</head>
<body>
  <header>Painel Administrativo</header>
  
  <div class="container">
    <h1>Adicionar Novo Texto</h1>
    <form id="form-texto">
      <div class="form-group">
        <label for="titulo">T√≠tulo</label>
        <input type="text" id="titulo" placeholder="Digite o t√≠tulo">
      </div>

      <div class="form-group">
        <label for="resumo">Resumo</label>
        <input type="text" id="resumo" placeholder="Pequeno resumo do texto">
      </div>

      <div class="form-group">
        <label for="meta">Tipo de Texto</label>
        <select id="meta">
          <option value="" disabled selected>Selecione o tipo</option>
          <option value="Cr√≠tica de Filme">Cr√≠tica de Filme</option>
          <option value="Cr√¥nica">Cr√¥nica</option>
          <option value="Opini√£o">Opini√£o</option>
        </select>
      </div>

      <!-- üî• Campo Nota -->
      <div class="form-group" id="nota-filme-group">
        <label for="nota-filme">Nota do Filme</label>
        <select id="nota-filme">
          <option value="">Selecione...</option>
          <option value="0">0</option>
          <option value="0,5">0,5</option>
          <option value="1">1</option>
          <option value="1,5">1,5</option>
          <option value="2">2</option>
          <option value="2,5">2,5</option>
          <option value="3">3</option>
          <option value="3,5">3,5</option>
          <option value="4">4</option>
          <option value="4,5">4,5</option>
          <option value="5">5</option>
        </select>
      </div>

      <div class="form-group">
        <label for="imagem">Imagem</label>
        <input type="text" id="imagem" placeholder="URL da imagem">
      </div>

      <div class="form-group">
        <label>Conte√∫do</label>
        <div id="editor"></div>
      </div>

      <button type="submit">Salvar</button>
    </form>

    <button class="logout" id="logoutBtn">Sair</button>
  </div>

  <!-- Quill Editor -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // üî• Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA5Nu6Bfg-QwmM3YnHLXHjNBbXi5aeK02k",
      authDomain: "textos-matheus.firebaseapp.com",
      projectId: "textos-matheus",
      storageBucket: "textos-matheus.appspot.com",
      messagingSenderId: "292723977997",
      appId: "1:292723977997:web:77baca4b9d2dd8ff638a44"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // üîê Verifica login
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      }
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });

    // Quill editor
    const quill = new Quill('#editor', {
      theme: 'snow',
      placeholder: 'Escreva seu texto aqui...',
      modules: {
        toolbar: [
          [{ header: [1, 2, 3, false] }],
          ['bold', 'italic', 'underline'],
          [{ 'align': [] }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link']
        ]
      }
    });

    // Mostrar/esconder campo Nota
    const metaSelect = document.getElementById("meta");
    const notaGroup = document.getElementById("nota-filme-group");
    metaSelect.addEventListener("change", () => {
      if (metaSelect.value === "Cr√≠tica de Filme") {
        notaGroup.style.display = "block";
      } else {
        notaGroup.style.display = "none";
      }
    });

    // Fun√ß√£o para gerar m√™s e ano
    function getMesAno() {
      const meses = [
        "Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho",
        "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"
      ];
      const agora = new Date();
      const mes = meses[agora.getMonth()];
      const ano = agora.getFullYear();
      return `${mes} ${ano}`;
    }

    // Salvar no Firestore
    document.getElementById("form-texto").addEventListener("submit", async (e) => {
      e.preventDefault();

      const tipo = metaSelect.value;
      const metaFinal = `${tipo} ‚Ä¢ ${getMesAno()}`;

      let conteudoHTML = quill.root.innerHTML;

      // üî• Se for Cr√≠tica de Filme e tiver nota, adiciona no final
      let nota = document.getElementById("nota-filme").value;
      if (tipo === "Cr√≠tica de Filme" && nota) {
        conteudoHTML += `<span class="nota-filme">Nota: ${nota}/5</span>`;
      } else {
        nota = null;
      }

      try {
        await addDoc(collection(db, "textos"), {
          titulo: document.getElementById("titulo").value.trim(),
          resumo: document.getElementById("resumo").value.trim(),
          meta: metaFinal,
          imagem: document.getElementById("imagem").value.trim(),
          conteudo: conteudoHTML,
          notaFilme: nota,
          criadoEm: serverTimestamp()
        });

        alert("‚úÖ Texto adicionado!");
        document.getElementById("form-texto").reset();
        quill.setContents([]);
        notaGroup.style.display = "none"; // esconde nota de novo
      } catch (error) {
        console.error("Erro ao salvar:", error);
        alert("‚ùå Erro ao salvar o texto. Veja o console.");
      }
    });
  </script>
</body>
</html>
